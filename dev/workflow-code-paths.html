<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workflow Code Paths &mdash; NEURON  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=6933245a" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/design-tabs.js?v=f930bc37"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="setuptools" href="setuptools/setuptools.html" />
    <link rel="prev" title="Testing GPU functionality" href="gpu-testing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            NEURON
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Building:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cmake_doc/index.html">CMake Build Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/developer.html">Developer Builds</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../videos/index.html">Training videos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../courses/exercises2018.html">NEURON Course Exercises</a></li>
<li class="toctree-l1"><a class="reference external" href="https://neuron.yale.edu/phpBB">The NEURON forum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications about NEURON</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications-using-neuron.html">Publications using NEURON</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NEURON scripting:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scripting.html">Running Python and HOC scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">NEURON Python documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hoc/index.html">NEURON HOC documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../otherscripting.html">Other scripting languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Python tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rxd-tutorials/index.html">Python RXD tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreneuron/index.html">CoreNEURON</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NMODLanguage:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nmodl/index.html">NMODLanguage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../scm/index.html">NEURON SCM and Release</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">NEURON Development topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="HOCInterpreter/HOCInterpreter.html">HOC Interpreter</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-do-i/how-do-i.html">How-Do-I Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-structures.html">Data structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu-testing.html">Testing GPU functionality</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Workflow Code Paths</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#neuron-simulations">NEURON simulations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#register-mechanisms">Register Mechanisms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#circuit-creation">Circuit creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#insert-mechanisms">Insert Mechanisms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#memory-allocation-of-field-data">Memory allocation of field data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization">Initialization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="setuptools/setuptools.html">setuptools</a></li>
<li class="toctree-l2"><a class="reference internal" href="morphology/morphology.html">Morphology loading in NEURON</a></li>
<li class="toctree-l2"><a class="reference internal" href="hocdomain-sphinx.html">HOC Sphinx Domain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../doxygen.html">C/C++ API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Removed Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../removed_features.html">Removed Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Changelog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">NEURON 8.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html#neuron-8-1">NEURON 8.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html#neuron-8-0">NEURON 8.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html#contributors">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html#feedback-help">Feedback / Help</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NEURON</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">NEURON Development topics</a></li>
      <li class="breadcrumb-item active">Workflow Code Paths</li>
<li class="wy-breadcrumbs-aside">
    
    
</li>

      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/dev/workflow-code-paths.rst.txt" rel="nofollow"> View page source</a>
      </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="workflow-code-paths">
<h1>Workflow Code Paths<a class="headerlink" href="#workflow-code-paths" title="Link to this heading"></a></h1>
<p>The intention of the following section is to give an overview of important functions and code paths executed to perform certain actions.</p>
<section id="neuron-simulations">
<h2>NEURON simulations<a class="headerlink" href="#neuron-simulations" title="Link to this heading"></a></h2>
<p>A summary of the workflow of a typical <code class="docutils literal notranslate"><span class="pre">NEURON</span></code> simulation can be given with the following graph:</p>
<img alt="../_images/execution_flow.svg" src="../_images/execution_flow.svg" /><p>The parts of the simulation can be described as:</p>
<section id="register-mechanisms">
<h3>Register Mechanisms<a class="headerlink" href="#register-mechanisms" title="Link to this heading"></a></h3>
<p>Mechanisms in <code class="docutils literal notranslate"><span class="pre">NEURON</span></code> are defined in <code class="docutils literal notranslate"><span class="pre">.mod</span></code> files. Apart from some built in mechanisms if the user wants to use any additional mechanisms those need to be compiled using the <cite>nrnivmodl</cite> executable.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">nrnivmodl</span></code> executable translates the <code class="docutils literal notranslate"><span class="pre">MOD</span></code> files from the <code class="docutils literal notranslate"><span class="pre">NMODL</span></code> language to <code class="docutils literal notranslate"><span class="pre">C++</span></code>. Those <code class="docutils literal notranslate"><span class="pre">C++</span></code> files apart from the computation kernels also include a function named <code class="docutils literal notranslate"><span class="pre">&lt;mechanism_name&gt;_reg_(void)</span></code> that is essential for registering the mechanism functions in <code class="docutils literal notranslate"><span class="pre">NEURON</span></code> so that later the user can <code class="docutils literal notranslate"><span class="pre">insert</span></code> the mechanism in the needed compartments.</p>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="889px" height="793px" viewBox="-0.5 -0.5 889 793"><defs/><g><rect x="0" y="0" width="48" height="24" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 15px; margin-left: 1px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Mechanism registration</div></div></div></foreignObject><text x="30" y="19" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Mechanism...</text></switch></g><path d="M 444 160 L 444 202.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444 207.11 L 441.2 201.51 L 444 202.91 L 446.8 201.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="0" y="56" width="888" height="104" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1108px; height: 1px; padding-top: 135px; margin-left: 1px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Every mechanism defines:  `&lt;mech_name&gt;_reg_(void)`.<br />`&lt;mech_name&gt;_reg_(void)` calls `<a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/init.cpp#L683" target="_blank">register_mech(mechanism, &lt;mech_name&gt;_alloc, &lt;mech_name&gt;_cur, &lt;mech_name&gt;_jacob, nullptr, nullptr, -1, 1);</a>`  and <br />`<a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/membfunc.h#L209" target="_blank">neuron::mechanism::register_data_fields(mechtype, <span style="background-color: initial;">field&lt;double&gt;{"&lt;var_name"}, </span></a><span style="background-color: initial;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/membfunc.h#L209" target="_blank">field&lt;double&gt;{"&lt;array_var_name", &lt;Array_size&gt;}, fields...);</a>`<br /></span>`register_mech` registrates the allocator, nrn_cur function, jacob function, etc<span style="background-color: initial;"><br /></span></div></div></div></foreignObject><text x="555" y="139" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Every mechanism defines:  `&lt;mech_name&gt;_reg_(void)`....</text></switch></g><path d="M 444 256 L 444 314.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444 319.11 L 441.2 313.51 L 444 314.91 L 446.8 313.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="24" y="208" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 290px; margin-left: 31px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">`register_data_fields`: takes care creating the storage underneath by calling</div></div></div></foreignObject><text x="555" y="294" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">`register_data_fields`: takes care creating the storage underneath by calling</text></switch></g><path d="M 444 368 L 444 426.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444 431.11 L 441.2 425.51 L 444 426.91 L 446.8 425.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="24" y="320" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 430px; margin-left: 31px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/init.cpp#L755" target="_blank">neuron::mechanism::detail::register_data_fields(int type, <span style="background-color: initial;">std::vector&lt;std::pair&lt;const char*, int&gt;&gt; const&amp; param_info, </span><span style="background-color: initial;">std::vector&lt;std::pair&lt;const char*, const char*&gt;&gt; const&amp; dparam_info</span>)</a></div></div></div></foreignObject><text x="555" y="434" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">neuron::mechanism::detail::register_data_fields(int type, std::vector&lt;std::pair&lt;const char*, int&gt;&gt; const&amp; param_info, std::vector&lt;std::pair&lt;const char*, const char*&gt;&gt; const&amp; d...</text></switch></g><path d="M 444 608 L 444 634.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444 639.11 L 441.2 633.51 L 444 634.91 L 446.8 633.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="24" y="528" width="840" height="80" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 710px; margin-left: 31px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/container.cpp#L105" target="_blank">neuron::container::Mechanism::storage(short mech_type, std::string name, std::vector&lt;Variable&gt; floating_point_fields)</a><br />floating_point_fields is a vector of structs that hold the informating for the various RANGE variables of the mechanism<br />We pass a `std::vector&lt;Variable&gt;` to a wrapper `neuron::container::Mechanism::field::FloatingPoint`. Due to the fact that the wrapper has a `num_instances` non static member function we need to allocate vectors for each one of the RANGE variables in the `m_var_info` member of `FloatingPoint`<br />neuron::container::Mechanism::storage sets `using base_type = soa&lt;storage, field::FloatingPoint&gt;;`</div></div></div></foreignObject><text x="555" y="714" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">neuron::container::Mechanism::storage(short mech_type, std::string name, std::vector&lt;Variable&gt; floating_point_fields)...</text></switch></g><path d="M 444 480 L 444 522.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444 527.11 L 441.2 521.51 L 444 522.91 L 446.8 521.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="24" y="432" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 570px; margin-left: 31px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/neuron/model_data.hpp#L43" target="_blank">neuron::Model::add_mechanism()</a></div></div></div></foreignObject><text x="555" y="574" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">neuron::Model::add_mechanism()</text></switch></g><rect x="104" y="744" width="680" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 848px; height: 1px; padding-top: 960px; margin-left: 131px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/neuron/container/soa_container.hpp#L195" target="_blank">field_data</a> of each variable</div></div></div></foreignObject><text x="555" y="964" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">field_data of each variable</text></switch></g><path d="M 444 688 L 444 738.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444 743.11 L 441.2 737.51 L 444 738.91 L 446.8 737.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="24" y="640" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 830px; margin-left: 31px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Creation of `soa` storage struct which holds a tuple of detaill:field_data structs which is the <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/neuron/container/soa_container.hpp#L1263" target="_blank">underyling storage</a></div></div></div></foreignObject><text x="555" y="834" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Creation of `soa` storage struct which holds a tuple of detaill:field_data structs which is the underyling storage</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</section>
<section id="circuit-creation">
<h3>Circuit creation<a class="headerlink" href="#circuit-creation" title="Link to this heading"></a></h3>
<p>During this part of the simulation the segments, sections and their connections are created. All these are created based on the circuit which is defined by the users in Python or HOC scripts with the respective API.</p>
<p>See: <a class="reference internal" href="../hoc/modelspec/programmatic/topology.html#topology"><span class="std std-ref">Topology</span></a> and <a class="reference internal" href="../hoc/modelspec/programmatic/topology.html#hoc-topology"><span class="std std-ref">Topology</span></a>.</p>
<p>During this part all the <code class="docutils literal notranslate"><span class="pre">Node</span></code> s are created as well as the <code class="docutils literal notranslate"><span class="pre">Section</span></code> s.</p>
<p>See C++ documentation: <a class="reference external" href="https://neuronsimulator.github.io/nrn/doxygen/struct_node.html">Node</a>, <a class="reference external" href="https://neuronsimulator.github.io/nrn/doxygen/struct_section.html">Section</a> and <a class="reference external" href="https://neuronsimulator.github.io/nrn/doxygen/cxprop_8cpp.html#af7ff12d644d3eb29873e7fd2c7b9a18b">SectionPool</a>.</p>
<p>The call graph of this part can be found below:</p>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="801px" height="489px" viewBox="-0.5 -0.5 801 489"><defs/><g><rect x="78.4" y="48" width="644" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 803px; height: 1px; padding-top: 90px; margin-left: 99px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/983ec7f00c30dfb4285f3e0f2db2fa00fbf763ed/src/nrnoc/cabcode.cpp#L173" target="_blank">add_section()</a></div></div></div></foreignObject><text x="501" y="94" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">add_section()</text></switch></g><rect x="78.4" y="0" width="48" height="24" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 15px; margin-left: 99px;"><div data-drawio-colors="color: #B3B3B3; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(179, 179, 179); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font color="#000000">Circuit creation</font></div></div></div></foreignObject><text x="128" y="19" fill="#B3B3B3" font-family="Helvetica" font-size="12px" text-anchor="middle">Circuit cr...</text></switch></g><rect x="78.4" y="144" width="644" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 803px; height: 1px; padding-top: 210px; margin-left: 99px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/cabcode.cpp#L272" target="_blank">new_sections()</a></div></div></div></foreignObject><text x="501" y="214" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">new_sections()</text></switch></g><rect x="0.4" y="248" width="800" height="88" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 998px; height: 1px; padding-top: 365px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/cabcode.cpp#L246" target="_blank">new_section()</a><br />This functions sets "tree_changed = 1;" which is used for shiffling sections later<br />It also calls "sec_alloc()" which allocates a `SectionPool`<br />It also allocates the `Node`s by calling cable_prop_assign()-&gt;nrn_change_nseg()-&gt;<a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/solve.cpp#L729" target="_blank">node_alloc()</a>:<br />there is one Node per segment</div></div></div></foreignObject><text x="501" y="369" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">new_section()...</text></switch></g><path d="M 400.4 96 L 400.4 138.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 400.4 143.11 L 397.6 137.51 L 400.4 138.91 L 403.2 137.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><path d="M 400.4 192 L 400.4 242.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 400.4 247.11 L 397.6 241.51 L 400.4 242.91 L 403.2 241.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="16.4" y="392" width="768" height="96" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 958px; height: 1px; padding-top: 550px; margin-left: 22px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Segments can also be connected/disconnected with various functions that set "tree_changed = 1;"<br /> <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/cabcode.cpp#L571" target="_blank">nrn_disconnect()</a>: called by functions that disconnect the section<br /><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/cabcode.cpp#L593" target="_blank">connectsec_impl()</a>: connection between two sections -&gt; "tree_changed = 1"<br /><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/cabcode.cpp#L1461" target="_blank">nrn_change_nseg()</a>: change the number of segments in section. It also sets `tree_changed = 1;`, `diam_changed = 1;` and `sec-&gt;recalc_area_ = 1;`</div></div></div></foreignObject><text x="501" y="554" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Segments can also be connected/disconnected with various functions that set "tree_changed = 1;"...</text></switch></g><path d="M 400.4 336 L 400.4 386.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 400.4 391.11 L 397.6 385.51 L 400.4 386.91 L 403.2 385.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</section>
<section id="insert-mechanisms">
<h3>Insert Mechanisms<a class="headerlink" href="#insert-mechanisms" title="Link to this heading"></a></h3>
<p>After registering the mechanisms the user can insert them in the needed compartments. To do so they need to call the <code class="docutils literal notranslate"><span class="pre">insert</span></code> function on the proper section.</p>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="913px" height="521px" viewBox="-0.5 -0.5 913 521"><defs/><g><rect x="0" y="0" width="48" height="24" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 15px; margin-left: 1px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Insert mechanism</div></div></div></foreignObject><text x="30" y="19" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Insert mec...</text></switch></g><path d="M 492 184 L 492 242.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492 247.11 L 489.2 241.51 L 492 242.91 L 494.8 241.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="72" y="136" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 200px; margin-left: 91px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/cabcode.cpp#L828" target="_blank">mech_insert1()</a>: insert mechanism to the Section (meaning all the nodes of the sction by calling prop_alloc())</div></div></div></foreignObject><text x="615" y="204" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">mech_insert1(): insert mechanism to the Section (meaning all the nodes of the sction by calling prop_alloc())</text></switch></g><path d="M 232 100 L 232 117.98 L 492.04 117.98 L 492.04 130.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492.04 135.11 L 489.24 129.51 L 492.04 130.91 L 494.84 129.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="72" y="52" width="320" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 398px; height: 1px; padding-top: 95px; margin-left: 91px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">From python: <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnpython/nrnpy_nrn.cpp#L1176" target="_blank">NPySecObj_insert</a></div></div></div></foreignObject><text x="290" y="99" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">From python: NPySecObj_insert</text></switch></g><path d="M 748.04 100 L 748.04 117.98 L 492.04 117.98 L 492.04 130.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492.04 135.11 L 489.24 129.51 L 492.04 130.91 L 494.84 129.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="584" y="52" width="328" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 408px; height: 1px; padding-top: 95px; margin-left: 731px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">From hoc: <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrniv/nrnmenu.cpp#L1272" target="_blank">MechanismType::insert</a></div></div></div></foreignObject><text x="935" y="99" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">From hoc: MechanismType::insert</text></switch></g><path d="M 492 296 L 492 354.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492 359.11 L 489.2 353.51 L 492 354.91 L 494.8 353.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="72" y="248" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 340px; margin-left: 91px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/treeset.cpp#L672" target="_blank">prop_alloc()</a><br style="border-color: var(--border-color);" />prop_alloc(): sets `v_structure_change = 1;`<br />It allocates a new `Prop` struct for the mechanism and calls the `&lt;mech_name&gt;_alloc` function defined in the mechanism file.</div></div></div></foreignObject><text x="615" y="344" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">prop_alloc()...</text></switch></g><path d="M 492 408 L 492 466.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492 471.11 L 489.2 465.51 L 492 466.91 L 494.8 465.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="72" y="360" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 480px; margin-left: 91px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/section.h#L231" target="_blank">`Prop` constructor</a> calls constructor of `Mechanism::owning_handle`, which inserts a new element into each of the underlying data vectors (`field_data&lt;Tag, FieldImplementation::RuntimeVariable&gt;::m_storage[i]` for all `i`)</div></div></div></foreignObject><text x="615" y="484" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">`Prop` constructor calls constructor of `Mechanism::owning_handle`, which inserts a new element into each of the underlying data vectors (`field_data&lt;Tag, FieldImplementation:...</text></switch></g><rect x="72" y="472" width="840" height="48" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1048px; height: 1px; padding-top: 620px; margin-left: 91px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Look at "Memory allocation of field_data"</div></div></div></foreignObject><text x="615" y="624" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Look at "Memory allocation of field_data"</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</section>
<section id="memory-allocation-of-field-data">
<h3>Memory allocation of field data<a class="headerlink" href="#memory-allocation-of-field-data" title="Link to this heading"></a></h3>
<p>During the mechanism insertion the needed data structures to hold their data are also allocated. This is done by appending to the SoA data structures of the data a new element for the newly inserted mechanism.</p>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="881px" height="578px" viewBox="-0.5 -0.5 881 578"><defs/><g><rect x="0" y="16.8" width="48" height="24" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 36px; margin-left: 1px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Memory allocation of field_data (SoAoS)</div></div></div></foreignObject><text x="30" y="40" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Memory all...</text></switch></g><path d="M 272 120.8 L 272 200.8 L 484 200.8 L 484 275.71" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 484 279.91 L 481.2 274.31 L 484 275.71 L 486.8 274.31 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="88" y="72.8" width="368" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 121px; margin-left: 111px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Node has <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/section.h#L108" target="_blank">neuron::container::Node::owning_handle</a> member</div></div></div></foreignObject><text x="340" y="125" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Node has neuron::container::Node::owning_handle member</text></switch></g><path d="M 484 360.8 L 484 475.71" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 484 479.91 L 481.2 474.31 L 484 475.71 L 486.8 474.31 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="88" y="280.8" width="792" height="80" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 988px; height: 1px; padding-top: 401px; margin-left: 111px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/neuron/container/soa_identifier.hpp#L80" target="_blank">Constructor of owning_handle</a>  calls <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/neuron/container/soa_container.hpp#L902" target="_blank">acquire_owning_identifier</a> for both </div></div></div></foreignObject><text x="605" y="405" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Constructor of owning_handle  calls acquire_owning_identifier for both </text></switch></g><path d="M 710.35 120.66 L 710.27 200.8 L 484 200.8 L 484 275.71" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 484 279.91 L 481.2 274.31 L 484 275.71 L 486.8 274.31 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="512" y="72.8" width="368" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 121px; margin-left: 641px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Prop has <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/section.h#L402" target="_blank">neuron::container::Mehcanism::owning_handle</a> member</div></div></div></foreignObject><text x="870" y="125" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Prop has neuron::container::Mehcanism::owning_handle member</text></switch></g><rect x="270" y="480.8" width="428" height="96" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 533px; height: 1px; padding-top: 661px; margin-left: 338px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">By calling for_all_vectors&lt;detail::may_cause_reallocation::Yes&gt;() we append to the m_storage of field_data an element. We also set the m_ptr (std::unique_ptr&lt;std::size_t, deleter&gt;) of the owning_identifier to the old_size. This identifier will be used as offset to access the corresponding element from other parts of the code. Due to the fact that we use the detail::may_cause_reallocation::Yes template, when we call for_all_vectors() the m_data_ptrs member of the field_data for mechanisms will be updated to use the up to date pointers to the m_storage vectors</div></div></div></foreignObject><text x="605" y="665" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">By calling for_all_vectors&lt;detail::may_cause_reallocation::Yes&gt;() we append to the m_stor...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</section>
<section id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Link to this heading"></a></h3>
<p>After all the simulation <code class="docutils literal notranslate"><span class="pre">Section</span></code> have been created, along with the data structures assigned to them and their mechanisms, all the underlying data structures are ordered and initialized. At this stage, the <code class="docutils literal notranslate"><span class="pre">INITIAL</span></code> blocks of the inserted <code class="docutils literal notranslate"><span class="pre">MOD</span></code> files are also executed.</p>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="749px" height="977px" viewBox="-0.5 -0.5 749 977"><defs/><g><rect x="70.4" y="0" width="48" height="24" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 15px; margin-left: 89px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Initialization</div></div></div></foreignObject><text x="118" y="19" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Initializa...</text></switch></g><path d="M 374.4 104 L 374.4 154.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 159.11 L 371.6 153.51 L 374.4 154.91 L 377.2 153.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="62.4" y="56" width="624" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 778px; height: 1px; padding-top: 100px; margin-left: 79px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Call to <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/fadvance.cpp#L941" target="_blank">finitialize()</a></div></div></div></foreignObject><text x="468" y="104" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Call to finitialize()</text></switch></g><path d="M 374.4 208 L 374.4 258.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 263.11 L 371.6 257.51 L 374.4 258.91 L 377.2 257.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="78.4" y="160" width="592" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 738px; height: 1px; padding-top: 230px; margin-left: 99px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/fadvance.cpp#L805" target="_blank">nrn_finitialize(int, double)</a><br />finitialize passes initial voltage value to finitialize</div></div></div></foreignObject><text x="468" y="234" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">nrn_finitialize(int, double)...</text></switch></g><path d="M 374.4 312 L 374.4 362.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 367.11 L 371.6 361.51 L 374.4 362.91 L 377.2 361.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="90.4" y="264" width="568" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 708px; height: 1px; padding-top: 360px; margin-left: 114px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrniv/finithnd.cpp#L33" target="_blank">nrn_fihexec(3);</a><br />Call to finitialize handler kernels with type == 3</div></div></div></foreignObject><text x="468" y="364" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">nrn_fihexec(3);...</text></switch></g><path d="M 374.4 416 L 374.4 474.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 479.11 L 371.6 473.51 L 374.4 474.91 L 377.2 473.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="22.4" y="368" width="704" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 878px; height: 1px; padding-top: 490px; margin-left: 29px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/fadvance.cpp#L792" target="_blank">verify_structure()</a><br />Takes care of recalculating circuit related geometry like topology, v vectors and diameters. Also calls nrn_solver_prepare </div></div></div></foreignObject><text x="468" y="494" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">verify_structure()...</text></switch></g><path d="M 374.4 528 L 374.4 594.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 599.11 L 371.6 593.51 L 374.4 594.91 L 377.2 593.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="18.4" y="480" width="712" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 888px; height: 1px; padding-top: 630px; margin-left: 24px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">if(tree_changed) -&gt; <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/cabcode.cpp#L1598" target="_blank">setup_topology()</a>: Sets up pointer to the parents of the sections</div></div></div></foreignObject><text x="468" y="634" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">if(tree_changed) -&gt; setup_topology(): Sets up pointer to the parents of the sections</text></switch></g><path d="M 374.4 648 L 374.4 706.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 711.11 L 371.6 705.51 L 374.4 706.91 L 377.2 705.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="66.4" y="600" width="616" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 768px; height: 1px; padding-top: 780px; margin-left: 84px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">if (v_structure_change) -&gt; <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/treeset.cpp#L1602" target="_blank">v_setup_vectors()</a>:<br />Frees and sets up: NrnThreads and memb_list, Calls function that setup auxiliary structs as well to keep track of pointers of C++ objects, Vectors of NrnThread, etc, Setup longitudinal diffusion with call to <a href="https://github.com/neuronsimulator/nrn/blob/e0290762790622291c4867dee25a7c13e0c2d326/src/nrnoc/ldifus.cpp#L86" target="_blank">long_difus_solve()</a>, Setup CVode with call to <a href="https://github.com/neuronsimulator/nrn/blob/e0290762790622291c4867dee25a7c13e0c2d326/src/nrnoc/nonvintblock.h#L38" target="_blank">nrn_nonvint_block_setup()</a></div></div></div></foreignObject><text x="468" y="784" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">if (v_structure_change) -&gt; v_setup_vectors():...</text></switch></g><path d="M 374.4 760 L 374.4 808.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 813.11 L 371.6 807.51 L 374.4 808.91 L 377.2 807.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="30.4" y="712" width="688" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 858px; height: 1px; padding-top: 920px; margin-left: 39px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">if (diam changed) -&gt; <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/treeset.cpp#L929" target="_blank">recalc_diam()</a>: Reruns v_setup_vectors(), allocates and sets hines matrix data structures in nrn_matrix_node_alloc() and connection_coef(), stim_prepare(), synapse_prepare() and clamp_prepare() set up record/stimulus/synapses</div></div></div></foreignObject><text x="468" y="924" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">if (diam changed) -&gt; recalc_diam(): Reruns v_setup_vectors(), allocates and sets hines matrix data structures in nrn_matrix_node_alloc() and co...</text></switch></g><path d="M 374.4 872 L 374.4 922.91" fill="none" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 374.4 927.11 L 371.6 921.51 L 374.4 922.91 L 377.2 921.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="0.8" stroke-miterlimit="10" pointer-events="all"/><rect x="146.4" y="814" width="456" height="58" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 568px; height: 1px; padding-top: 1054px; margin-left: 184px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrncvode/cvodestb.cpp#L96" target="_blank">nrn_solver_prepare()</a>: prepare CVode for execution<br />Sets up fornetcon objects, calls <a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrncvode/netcvode.cpp#L1545" target="_blank">NetCvode::init_global</a> that does a final check that topology, vectors and recalc_diam are set.</div></div></div></foreignObject><text x="468" y="1057" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">nrn_solver_prepare(): prepare CVode for execution...</text></switch></g><rect x="0.4" y="928" width="748" height="48" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="0.8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject pointer-events="none" width="125%" height="125%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 933px; height: 1px; padding-top: 1190px; margin-left: 1px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/treeset.cpp#L2286" target="_blank">nrn_ensure_model_data_are_sorted()</a></div></div></div></foreignObject><text x="468" y="1194" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">nrn_ensure_model_data_are_sorted()</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gpu-testing.html" class="btn btn-neutral float-left" title="Testing GPU functionality" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="setuptools/setuptools.html" class="btn btn-neutral float-right" title="setuptools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Duke, Yale and the Blue Brain Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>